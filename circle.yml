machine:
  php:
    version: 5.6.22
  services:
    - mysql
  environment:
    APPLICATION_ENV: test
    DB_HOST: localhost
    DB_NAME: phalcon_base_project_test
    DB_USERNAME: root
    DB_PASSWORD: ""
    DEBUG: true
    OAUTH_ENABLED: true
    CLIENT_SECRET: client_secret
    CLIENT_ID: client_id
  hosts:
    test.phalconbaseproject.com: 127.0.0.1

test:
  override:
    - ant build

dependencies:
  override:
    - LC_ALL=C.UTF-8 sudo add-apt-repository -y ppa:ondrej/php; sudo apt-get update; sudo apt-get install -y php5.6
    - sudo apt-get install php5.6-dev
    - rm /opt/circleci/php/$(phpenv global)/etc/conf.d/xdebug.ini
    - git clone --depth=1 git://github.com/phalcon/cphalcon.git; cd cphalcon/build; sudo ./install;
    - sudo echo "extension=/usr/lib/php/20131226/phalcon.so" | sudo tee -a /opt/circleci/php/$(phpenv global)/etc/php.ini
    - sudo apt-get install ant
    - composer config -g github-oauth.github.com $GITHUB_TOKEN
    - composer install
    - touch env/.env.test
    - chmod -R 777 App/logs